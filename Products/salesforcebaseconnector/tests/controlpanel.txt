Salesforce Base Connector control panel
=======================================

First some initial setup code:

    >>> from Products.salesforcebaseconnector.tests import sfconfig
    >>> from Products.CMFCore.utils import getToolByName
    >>> qi = getToolByName(self.portal, 'portal_quickinstaller')
    >>> qi.installProduct('Products.salesforcebaseconnector')
    ''
    >>> sbc = getToolByName(self.portal, 'portal_salesforcebaseconnector')
    >>> self.loginAsManager()

Viewing the salesforce control panel
------------------------------------

    >>> self.browser.open('http://nohost/plone/@@salesforce-controlpanel')
    >>> self.browser.url.endswith('salesforce-controlpanel')
    True

Click the cancel button:

    >>> self.browser.getControl(name="form.actions.cancel").click()
    >>> self.browser.url.endswith('plone_control_panel')
    True

There should be still no changes:

    >>> 'Changes canceled.' in self.browser.contents
    True

Make some changes, but with invalid values
------------------------------------------

    >>> self.browser.open('http://nohost/plone/@@salesforce-controlpanel')
    >>> self.browser.url.endswith('salesforce-controlpanel')
    True

    >>> self.browser.getControl(name='form.username').value = 'bad user'
    >>> self.browser.getControl(name='form.password').value = 'not a real password'

Click the save button:

    >>> self.browser.getControl(name="form.actions.save").click()
    >>> self.browser.url.endswith('salesforce-controlpanel')
    True

We should hear about the error:

    >>> 'The supplied values could not be stored.' in self.browser.contents
    True

Try again, but with valid credentials
-------------------------------------

    >>> self.browser.open('http://nohost/plone/@@salesforce-controlpanel')
    >>> self.browser.url.endswith('salesforce-controlpanel')
    True

    >>> self.browser.getControl(name='form.username').value = sfconfig.USERNAME
    >>> self.browser.getControl(name='form.password').value = sfconfig.PASSWORD
    >>> self.browser.getControl(name='form.server_url').value = 'https://www.salesforce.com/services/Soap/u/8.0'
    >>> self.browser.getControl(name="form.actions.save").click()
    >>> self.browser.url.endswith('salesforce-controlpanel')
    True
    
Should get good news this time:

    >>> 'Supplied values tested successfully.' in self.browser.contents
    True
    
Make sure the changes have been applied correctly to the base connector:

    >>> sbc.getUsername() == sfconfig.USERNAME
    True

    >>> sbc.getPassword() == sfconfig.PASSWORD
    True

    >>> sbc.serverUrl
    'https://www.salesforce.com/services/Soap/u/8.0'

